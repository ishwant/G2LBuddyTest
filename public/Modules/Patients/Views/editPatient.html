
<div class="container" ng-controller="singlePatientCtrl" ng-init='getUrlParamtoEditPatient()'>
    <div class="container">
        <h1 align="left">EDIT PATIENT PROFILE</h1>
    <br></br>
  <form class="form-horizontal" role="form" name="editPatientProfileForm" ng-submit="submitted = true" novalidate ng-init= 'viewRegisteredPatient()'>

    <!-- Patient p_id Condition: Required -->
    <div class="form-group" ng-class="{ 'has-error' : editPatientProfileForm.p_id.$invalid && !editPatientProfileForm.p_id.$pristine }">

        <label class="control-label col-sm-2">* Patient ID: </label>

        <div class="col-sm-3">
            <input  type="text" 
                    class="form-control" 
                    name="p_id" 
                    ng-model="patient.p_id"                    
                    id="p_id"
                    disabled
                    required>
        </div>
    </div>

    <!-- Patient First Name: Required  -->
    <div class="form-group" ng-class="{ 'has-error' : editPatientProfileForm.first_name.$invalid && !editPatientProfileForm.first_name.$pristine }">

        <label class="control-label col-sm-2">* First Name:</label>

        <div class="col-sm-3">
            <input  type="text" 
                    class="form-control" 
                    name="first_name" 
                    ng-model="patient.p_first_name" 
                    required>
            <p ng-show="editPatientProfileForm.first_name.$invalid && !editPatientProfileForm.first_name.$pristine" class="help-block">First Name is required!</p>
            <span ng-if="submitted && editPatientProfileForm.first_name.$error.required">First Name is required!</span> 
        </div>
    </div>

    <!-- Patient Last Name -->
    <div class="form-group">

        <label class="control-label col-sm-2" for="last_name" >  Last Name:</label>

        <div class="col-sm-3">
            <input  type="last_name" 
                    class="form-control" 
                    name="last_name" 
                    ng-model="patient.p_last_name">
        </div>
    </div>

    <!-- Patient Date of Birth: Required -->
    <div class="form-group" ng-class="{ 'has-error' : editPatientProfileForm.dob.$invalid && !editPatientProfileForm.dob.$pristine }">

        <label class="control-label col-sm-2">* Date of Birth:</label>

        <div class="col-sm-3">
            <input  type="date" 
                    class="form-control"
                    name="dob" 
                    ng-model="patient.p_dob" 
                    Required>
       <!-- <div class="input-group date" data-provide="datepicker">
            <input  type="text" 
                    class="form-control" 
                    name="dob" 
                    ng-model="patient.p_dob"  
                    required>
            <div class="input-group-addon">
                <span class="glyphicon glyphicon-th"></span>
                <p ng-show="editPatientProfileForm.dob.$invalid && !editPatientProfileForm.dob.$pristine" class="help-block">Date of Birth is required! Pick a date</p>
                <span ng-if="submitted && editPatientProfileForm.dob.$error.required">Date of Birth is required! Pick a date</span> 
            </div>
        </div> -->
        </div>
    </div>

    <!-- Patient Address1: Required -->
    <div class="form-group" ng-class="{ 'has-error' : editPatientProfileForm.address1.$invalid && !editPatientProfileForm.address1.$pristine }">

        <label class="control-label col-sm-2">* Address:</label>

        <div class="col-sm-4">
            <input  type="text" 
                    class="form-control" 
                    name="address1" 
                    ng-model="patient.p_address1"  
                    required>
            <p ng-show="editPatientProfileForm.address1.$invalid && !editPatientProfileForm.address1.$pristine" class="help-block">Enter address</p>
            <span ng-if="submitted && editPatientProfileForm.address1.$error.required">Enter address</span> 
        </div>
    </div>

    <!-- Patient Address2 -->
    <div class="form-group">

        <label class="control-label col-sm-2">Apt#:</label>

        <div class="col-sm-3">
            <input  type="address2" 
                    class="form-control" 
                    name="address2" 
                    ng-model="patient.p_address2">
        </div>
    </div>

    <!-- Patient City: Required -->
    <div class="form-group" ng-class="{ 'has-error' : editPatientProfileForm.city.$invalid && !editPatientProfileForm.city.$pristine }">

        <label class="control-label col-sm-2">* City:</label>

        <div class="col-sm-3">
            <input  type="city" 
                    class="form-control" 
                    name="city" 
                    ng-model="patient.p_city"  
                    required> 
            <p ng-show="editPatientProfileForm.city.$invalid && !editPatientProfileForm.city.$pristine" class="help-block">Select City</p>
            <span ng-if="submitted && editPatientProfileForm.city.$error.required">Select City</span> 
        </div>
    </div>

    <!-- Patient State: Required -->
    <div class="form-group" ng-class="{ 'has-error' : editPatientProfileForm.state.$invalid && !editPatientProfileForm.state.$pristine }">

        <label class="control-label col-sm-2">* State:</label>

        <div class="col-sm-3">
            <input  type="state" 
                    class="form-control" 
                    name="state" 
                    ng-model="patient.p_state"  
                    required>
            <p ng-show="editPatientProfileForm.state.$invalid && !editPatientProfileForm.state.$pristine" class="help-block">Select State</p>
            <span ng-if="submitted && editPatientProfileForm.state.$error.required">Select State</span> 
        </div>
    </div>

    <!-- Patient Zip: Required, Minimum length= 5 -->
    <div class="form-group" ng-class="{ 'has-error' : editPatientProfileForm.zip.$invalid && !editPatientProfileForm.zip.$pristine }">

        <label class="control-label col-sm-2">* Zip Code:</label>

        <div class="col-sm-2">
            <input  type="zip" 
                    class="form-control" 
                    name="zip" 
                    ng-model="patient.p_zipcode"  
                    minlength="5" 
                    required>
            <p ng-show="editPatientProfileForm.zip.$invalid && !editPatientProfileForm.zip.$pristine" class="help-block">Enter a valid Zip code</p>
            <span ng-if="submitted && editPatientProfileForm.zip.$error.required">Enter Zip code</span> 
        </div>
    </div>

    <!-- Patient Phone: Required-->
    <div class="form-group" ng-class="{ 'has-error' : editPatientProfileForm.phone.$invalid && !editPatientProfileForm.phone.$pristine }">

        <label class="control-label col-sm-2" for="phone">Phone:</label>

        <div class="col-sm-3">
            <input  type="text" 
                    class="form-control" 
                    name="phone" 
                    ng-model="patient.p_mobile_contact">
            <p ng-show="editPatientProfileForm.phone.$invalid && !editPatientProfileForm.phone.$pristine" class="help-block">Enter a valid phone number!</p>
            <span ng-if="submitted && editPatientProfileForm.phone.$error.required">Enter a phone number</span> 
        </div>
    </div>

    <!-- Patient email address: Check for @ -->
    <div class="form-group" ng-class="{ 'has-error' : editPatientProfileForm.email.$invalid && !editPatientProfileForm.email.$pristine }">

        <label class="control-label col-sm-2" for="Email">Email:</label>

        <div class="col-sm-4">
            <input  type="email" 
                    class="form-control" 
                    name="email" 
                    ng-model="patient.p_email">
            <p ng-show="editPatientProfileForm.email.$invalid && !editPatientProfileForm.email.$pristine" class="help-block">Enter a valid email address!</p>
        </div>
    </div>

    <!-- Patient's Case worker: Required -->
    <div ng-if="((currentUser.role.indexOf('admin') > -1)||(currentUser.role.indexOf('super') > -1))" class="form-group" ng-class="{ 'has-error' : editPatientProfileForm.case_worker.$invalid && !editPatientProfileForm.case_worker.$pristine }" >

        <label class="control-label col-sm-2" for="case_worker" >* Case Worker:</label>

        <div class="col-sm-4" ng-controller="allCaseWorkersCtrl" ng-init="getAllCaseWorkers()">

            <select class="form-control" 
                    id="case_worker" 
                    ng-model="patient.p_case_worker"  
                    ng-change="changeValue(patient.p_case_worker)" 
                    required>
                <option ng-repeat="user in users">{{user.c_first_name}} {{user.c_last_name}} (ID = {{user.c_id}})</option>
            </select>
            <!-- <select class="form-control" 
                    id="case_worker" 
                    ng-model="patient.p_case_worker"  
                    ng-change="changeValue(patient.p_case_worker)" 
                    required>
                <option ng-repeat="user in users">{{user.c_first_name}} {{user.c_last_name}} (ID = {{user.c_id}})</option>
            </select> -->
            <!-- <select class="form-control" id="case_worker" ng-model="patient.p_case_worker" ng-controller="allCaseWorkersCtrl" ng-init="getAllCaseWorkers()" ng-change="changeValue(patient.p_case_worker)" required>
                <option ng-repeat="user in users">{{user.c_first_name}} {{user.c_last_name}} (ID = {{user.c_id}})</option>
            </select> -->
            <p  ng-show="editPatientProfileForm.case_worker.$invalid && !editPatientProfileForm.case_worker.$pristine" 
                class="help-block">
                Select a case worker!
            </p>
            <span ng-if="submitted && editPatientProfileForm.case_worker.$error.required">Select a case worker!</span> 
        </div>
    </div>

    <!-- Patient's Token -->
    <div class="form-group">

        <label class="control-label col-sm-2" >Registration Token:</label>

        <div class="col-sm-3">
        	<input  type="text" 
                    class="form-control" 
                    name="p_token" 
                    ng-model="patient.p_token" 
                    ng-value="patient.p_token"
                    disabled
                    required> 
        </div>
        <div class="col-sm-3">
        	<button ng-click="generateToken()" 
                	class="btn btn-primary">
            			Generate New Token
        	</button>
        </div>
    </div>

    <!-- Patient's Program: Required -->
    <div class="form-group">

        <label class="control-label col-sm-2" for="program" required>* Program:</label>

        <div class="col-sm-3" ng-controller="programCtrl" ng-init="getAllPrograms()">
            <div ng-repeat="program in programs">
                <input type="checkbox" checkbox-group />
                <label>{{program.programAlias}} ({{program.programName}})</label>
            </div>
        <!-- <div class="col-sm-3">
            <select multiple class="form-control" id="program" ng-controller="programCtrl" ng-init="getAllPrograms()" ng-model="patient.p_program" ng-change="changeValue(patient.p_program)">
                <option ng-repeat="program in programs">{{program.programName}}</option>
            </select>  --> 
        </div>
    </div>
    <br></br>
    <div class="form-actions" >

        <button type="submit" 
                ng-click="editPatientProfileForm.$valid && editPatient(patient,editPatientProfileForm.$valid)" 
                class="btn btn-primary btn-lg" 
                style="padding: 5px 100px; float: left; margin-left: 70px">
            UPDATE
        </button> 
    </div>
  </form>
  <br></br>
  <br></br>
  <br></br>
</div>
</div>